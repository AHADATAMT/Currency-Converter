const dataFixer_offline = {
    "success": true,
    "timestamp": 1551776526,
    "base": "EUR",
    "date": "2019-03-05",
    "rates": {
        "AED": 4.1628,
        "AFN": 85.608157,
        "ALL": 124.640856,
        "AMD": 556.089877,
        "ANG": 2.056552,
        "AOA": 356.0527,
        "ARS": 45.13705,
        "AUD": 1.600681,
        "AWG": 2.039949,
        "AZN": 1.932254,
        "BAM": 1.955517,
        "BBD": 2.268197,
        "BDT": 95.277195,
        "BGN": 1.956141,
        "BHD": 0.42729,
        "BIF": 2044.14223,
        "BMD": 1.133248,
        "BND": 1.530924,
        "BOB": 7.844228,
        "BRL": 4.27885,
        "BSD": 1.133815,
        "BTC": 0.000302,
        "BTN": 80.096429,
        "BWP": 12.065139,
        "BYN": 2.426633,
        "BYR": 22212.778014,
        "BZD": 2.284175,
        "CAD": 1.51209,
        "CDF": 1847.287139,
        "CHF": 1.134223,
        "CLF": 0.028386,
        "CLP": 747.3005,
        "CNY": 7.595636,
        "COP": 3504.689049,
        "CRC": 686.861717,
        "CUC": 1.133305,
        "CUP": 30.032583,
        "CVE": 110.259814,
        "CZK": 25.605366,
        "DJF": 201.410622,
        "DKK": 7.461737,
        "DOP": 57.418913,
        "DZD": 134.628199,
        "EGP": 19.874771,
        "ERN": 16.999809,
        "ETB": 31.963173,
        "EUR": 1,
        "FJD": 2.408557,
        "FKP": 0.861283,
        "GBP": 0.859955,
        "GEL": 3.025851,
        "GGP": 0.859902,
        "GHS": 6.261495,
        "GIP": 0.861255,
        "GMD": 56.115623,
        "GNF": 10337.097994,
        "GTQ": 8.736591,
        "GYD": 236.685098,
        "HKD": 8.896047,
        "HNL": 27.693402,
        "HRK": 7.425182,
        "HTG": 94.189544,
        "HUF": 315.473548,
        "IDR": 16061.765123,
        "ILS": 4.103926,
        "IMP": 0.859902,
        "INR": 80.054967,
        "IQD": 1352.089531,
        "IRR": 47717.806591,
        "ISK": 136.518042,
        "JEP": 0.859902,
        "JMD": 144.835996,
        "JOD": 0.803285,
        "JPY": 126.865567,
        "KES": 113.387446,
        "KGS": 79.021395,
        "KHR": 4532.538306,
        "KMF": 492.987492,
        "KPW": 1020.047007,
        "KRW": 1276.203553,
        "KWD": 0.344684,
        "KYD": 0.944264,
        "KZT": 426.371781,
        "LAK": 9726.420015,
        "LBP": 1710.10037,
        "LKR": 203.303885,
        "LRD": 183.311876,
        "LSL": 16.137848,
        "LTL": 3.346355,
        "LVL": 0.685525,
        "LYD": 1.571328,
        "MAD": 10.861538,
        "MDL": 19.394812,
        "MGA": 4009.971295,
        "MKD": 61.493177,
        "MMK": 1723.64332,
        "MNT": 2985.551278,
        "MOP": 9.161241,
        "MRO": 404.589537,
        "MUR": 38.908065,
        "MVR": 17.521125,
        "MWK": 825.760078,
        "MXN": 21.854937,
        "MYR": 4.618231,
        "MZN": 71.086527,
        "NAD": 16.132608,
        "NGN": 408.560844,
        "NIO": 37.280635,
        "NOK": 9.81513,
        "NPR": 128.508608,
        "NZD": 1.667607,
        "OMR": 0.436334,
        "PAB": 1.133248,
        "PEN": 3.749256,
        "PGK": 3.824734,
        "PHP": 59.150611,
        "PKR": 158.424944,
        "PLN": 4.302332,
        "PYG": 6894.352062,
        "QAR": 4.126314,
        "RON": 4.741407,
        "RSD": 118.04523,
        "RUB": 74.508001,
        "RWF": 1019.980167,
        "SAR": 4.251256,
        "SBD": 9.21122,
        "SCR": 15.503386,
        "SDG": 53.955562,
        "SEK": 10.568658,
        "SGD": 1.535124,
        "SHP": 1.496985,
        "SLL": 9888.085737,
        "SOS": 657.316635,
        "SRD": 8.452184,
        "STD": 23856.749806,
        "SVC": 9.914602,
        "SYP": 583.652079,
        "SZL": 16.141619,
        "THB": 36.048174,
        "TJS": 10.685475,
        "TMT": 3.966568,
        "TND": 3.445361,
        "TOP": 2.563819,
        "TRY": 6.086299,
        "TTD": 7.694631,
        "TWD": 34.940873,
        "TZS": 2658.28182,
        "UAH": 30.406705,
        "UGX": 4189.259379,
        "USD": 1.133305,
        "UYU": 37.047504,
        "UZS": 9512.962372,
        "VEF": 11.318885,
        "VND": 26293.129338,
        "VUV": 129.22923,
        "WST": 2.94058,
        "XAF": 655.820346,
        "XAG": 0.075071,
        "XAU": 0.000882,
        "XCD": 3.062813,
        "XDR": 0.81428,
        "XOF": 655.88917,
        "XPF": 119.2465,
        "YER": 283.672376,
        "ZAR": 16.06641,
        "ZMK": 10201.069317,
        "ZMW": 13.614404,
        "ZWL": 365.326546
    }
};
let dataFixer_;
const currencyDom = document.getElementById('currency');
const amountDom = document.getElementById('amount');
const amountInput = document.getElementById('amount-input');
const amountOutput = document.getElementById('amount-output');
const currencyInput = document.getElementById('currency-input');
const currencyOutput = document.getElementById('currency-output');

function dataFixer() {
    const url = 'http://data.fixer.io/api/latest?access_key=7e8cc33de57686338386718cb87adc00&format=1';
    return new Promise(function (resolve, reject) {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function (e) {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    resolve(xhr.response)
                } else {
                    reject(xhr.status)
                }
            }
        }
        xhr.ontimeout = function () {
            reject('timeout')
        }
        xhr.open('get', url, true)
        xhr.send()
    })
}

dataFixer().then((data) => {
    dataFixer_ = JSON.parse(data);
    let dataRates = dataFixer_.rates;

    // List donw all of currency
    let curreny = Object.keys(dataRates);
    for (let cur in curreny) {
        if (curreny.hasOwnProperty(cur)) {
            const optionCurrency = '<option value="' + curreny[cur] + '">' + curreny[cur] + '</option>'
            currencyDom.children[0].insertAdjacentHTML('beforeend', optionCurrency);
            currencyDom.children[1].insertAdjacentHTML('beforeend', optionCurrency);
        }
    }

});

function calculator(isSwap = false) {
    console.log(isSwap);
    dataRates = dataFixer_.rates;
    let amountDom_in = amountDom.children[0].value;
    let amountDom_out = amountDom.children[1].value;
    let currencyDom_in = currencyDom.children[0].value;
    let currencyDom_out = currencyDom.children[1].value;

    let Rate_curIn = dataRates[currencyDom_in];
    let Rate_curOut = dataRates[currencyDom_out];

    if (isSwap) {
        amountDom_in = amountDom_out * Rate_curIn / Rate_curOut;
    } else {
        amountDom_out = amountDom_in * Rate_curOut / Rate_curIn;
    }
    
    amountDom.children[0].value = parseFloat(amountDom_in).toFixed(2);
    amountDom.children[1].value = parseFloat(amountDom_out).toFixed(2);
}

currencyDom.addEventListener('change', () => calculator());

amountDom.children[0].addEventListener('change', () => calculator());
amountDom.children[1].addEventListener('change', () => calculator(true));